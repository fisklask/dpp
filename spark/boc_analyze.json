{"paragraphs":[{"text":"%spark\n\nimport com.datastax.spark.connector._\nimport org.apache.spark.sql.cassandra._\n\n// boc.answersテーブル\nval rdd = sc.cassandraTable(\"boc\", \"answers\")\n\nval reduced = rdd.map{row =>\n    val qid  = row.getString(\"question_id\")\n    val idx = row.getInt(\"answer_idx\")\n    // 回答が0か1かで加算用のtupleを生成\n    if(idx == 0) {\n        // 回答が0\n        (qid, (1, 0))\n    } else {\n        // 回答が1\n        (qid, (0, 1))\n    }\n}.reduceByKey((a, b) => (a._1 + b._1, a._2 + b._2)) // 集計\n\n// Cassandraに反映\n// これは存在しないquestion_idでも保存してしまうので本来はOUT\n// デモ用で変なデータは普通には作れないのでいったんこのまま\nreduced.map(t => (t._1, t._2._1, t._2._2))\n    .saveToCassandra(\"boc\", \"questions\", SomeColumns(\"question_id\" as \"_1\", \"question_count0\" as \"_2\", \"question_count1\" as \"_3\"))","user":"anonymous","dateUpdated":"2017-06-15T06:43:41+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1497509021278_-1326889120","id":"20170615-064341_1392802613","dateCreated":"2017-06-15T06:43:41+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1925"},{"text":"%cassandra\nSELECT * FROM boc.questions;","user":"anonymous","dateUpdated":"2017-06-15T06:48:36+0000","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/undefined"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1497509021282_-1340740081","id":"20170615-064341_519145568","dateCreated":"2017-06-15T06:43:41+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1926"},{"text":"%cassandra\nSELECT * FROM boc.answers;","user":"anonymous","dateUpdated":"2017-06-15T06:48:40+0000","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/undefined"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1497509021292_-1346126565","id":"20170615-064341_1865118634","dateCreated":"2017-06-15T06:43:41+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1927"},{"text":"%cassandra\n","user":"anonymous","dateUpdated":"2017-06-15T06:43:41+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/undefined"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1497509021294_-1345357068","id":"20170615-064341_331773691","dateCreated":"2017-06-15T06:43:41+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1928"},{"text":"%cassandra\n","user":"anonymous","dateUpdated":"2017-06-15T06:43:41+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/undefined"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1497509021294_-1345357068","id":"20170615-064341_864151540","dateCreated":"2017-06-15T06:43:41+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1929"}],"name":"boc_analyze","id":"2CJKAYW1G","angularObjects":{"2CM91JM63:shared_process":[],"2CNFF3RWG:shared_process":[],"2CNM2SM17:shared_process":[],"2CHU1T3Z2:shared_process":[],"2CMET9ZHC:shared_process":[],"2CK86JYQF:shared_process":[],"2CJATMS14:shared_process":[],"2CMRWDNZB:shared_process":[],"2CMZ6XM5R:shared_process":[],"2CKX35H42:shared_process":[],"2CM3W3CYH:shared_process":[],"2CJA3PEJ3:shared_process":[],"2CKPS1DN1:shared_process":[],"2CKU6YHCH:shared_process":[],"2CJ35UEAZ:shared_process":[],"2CJQQTUNP:shared_process":[],"2CMZS38FM:shared_process":[],"2CMCY37MJ:shared_process":[],"2CKMSNPHX:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false","cronExecutingUser":"anonymous","cron":"0 0/1 * * * ?","releaseresource":true},"info":{}}